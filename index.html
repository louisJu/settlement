<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>정산 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-4xl mx-auto space-y-6">
    <!-- 참여자 관리 -->
    <div class="bg-white p-6 rounded-2xl shadow">
      <h2 class="text-lg font-semibold mb-4">참여자 관리</h2>
      <div class="flex gap-2 mb-3">
        <input id="personName" type="text" placeholder="이름 입력"
          class="flex-1 rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-500" />
        <button onclick="addPerson()" 
          class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">추가</button>
      </div>
      <div id="personList" class="flex flex-wrap gap-2"></div>
    </div>

    <!-- 지출 추가 -->
    <div class="bg-white p-6 rounded-2xl shadow">
      <h2 class="text-lg font-semibold mb-4">지출 추가</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input id="expenseTitle" type="text" placeholder="항목"
          class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-500" />
        <input id="expenseAmount" type="number" placeholder="금액"
          class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-500" />
        <select id="paidBy"
          class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-500">
          <option value="">결제자 선택</option>
        </select>
      </div>
      <div class="mt-3">
        <span class="font-semibold">정산 대상자:</span>
        <div id="involvedPeopleContainer" class="flex flex-wrap gap-2 mt-2"></div>
      </div>
      <button onclick="addExpense()"
        class="mt-4 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">지출 추가</button>
    </div>

    <!-- 지출 목록 -->
    <div class="bg-white p-6 rounded-2xl shadow">
      <h2 class="text-lg font-semibold mb-4">지출 목록</h2>
      <div id="expenseList" class="space-y-3"></div>
    </div>

    <!-- 정산 요약 -->
    <div class="bg-white p-6 rounded-2xl shadow">
      <h2 class="text-lg font-bold mb-4">정산 요약</h2>
      <ul id="summaryList" class="space-y-1 font-bold text-lg"></ul>
    </div>
  </div>

  <script>
    const people = [];
    const expenses = [];

    function renderPeople() {
      const personList = document.getElementById("personList");
      const paidBy = document.getElementById("paidBy");
      const involvedContainer = document.getElementById("involvedPeopleContainer");

      personList.innerHTML = "";
      paidBy.innerHTML = '<option value="">결제자 선택</option>';
      involvedContainer.innerHTML = "";

      people.forEach((person, index) => {
        // 참여자 목록
        const badge = document.createElement("div");
        badge.className = "flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-700 rounded-full";
        badge.innerHTML = `
          ${person}
          <button onclick="removePerson(${index})" class="text-red-500 hover:text-red-700">&times;</button>
        `;
        personList.appendChild(badge);

        // 결제자 select
        const opt1 = new Option(person, person);
        paidBy.add(opt1);

        // 정산 대상자 체크박스
        const checkbox = document.createElement("label");
        checkbox.className = "flex items-center gap-1 px-2 py-1 bg-gray-200 rounded-md cursor-pointer";
        checkbox.innerHTML = `
          <input type="checkbox" class="involved-checkbox" value="${person}" checked>
          ${person}
        `;
        involvedContainer.appendChild(checkbox);
      });
    }

    function addPerson() {
      const input = document.getElementById("personName");
      const name = input.value.trim();
      if (!name) return;
      if (people.includes(name)) return alert("이미 존재하는 이름입니다.");
      people.push(name);
      input.value = "";
      renderPeople();
      updateSummary();
    }

    function removePerson(index) {
      people.splice(index, 1);
      renderPeople();
      updateSummary();
    }

    function addExpense() {
      const title = document.getElementById("expenseTitle").value.trim();
      const amount = parseFloat(document.getElementById("expenseAmount").value);
      const paidBy = document.getElementById("paidBy").value;
      const involved = Array.from(document.querySelectorAll(".involved-checkbox:checked")).map(cb => cb.value);

      if (!title || isNaN(amount) || !paidBy || involved.length === 0) {
        return alert("모든 항목을 입력해주세요.");
      }

      expenses.push({ title, amount, paidBy, involved });

      // 초기화
      document.getElementById("expenseTitle").value = "";
      document.getElementById("expenseAmount").value = "";
      document.getElementById("paidBy").value = "";
      document.querySelectorAll(".involved-checkbox").forEach(cb => cb.checked = true);

      renderExpenses();
      updateSummary();
    }

    function renderExpenses() {
      const container = document.getElementById("expenseList");
      container.innerHTML = "";
      expenses.forEach((exp, index) => {
        const colors = ["bg-purple-100", "bg-green-100", "bg-yellow-100", "bg-pink-100", "bg-blue-100"];
        const tr = document.createElement("div");
        tr.className = `p-4 rounded-xl shadow flex justify-between items-center ${colors[index % colors.length]}`;

        tr.innerHTML = `
          <div>
            <div class="font-semibold">${exp.title}</div>
            <div>${exp.amount.toLocaleString()}원</div>
            <div>결제자: ${exp.paidBy}</div>
            <div>정산 대상자: ${exp.involved.join(", ")}</div>
          </div>
          <button onclick="removeExpense(${index})" class="px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600">삭제</button>
        `;
        container.appendChild(tr);
      });
    }

    function removeExpense(index) {
      expenses.splice(index, 1);
      renderExpenses();
      updateSummary();
    }

    function updateSummary() {
      const balances = {};
      people.forEach(p => balances[p] = 0);

      expenses.forEach(exp => {
        const share = exp.amount / exp.involved.length;
        exp.involved.forEach(person => {
          balances[person] -= share;
        });
        balances[exp.paidBy] += exp.amount;
      });

      const summaryList = document.getElementById("summaryList");
      summaryList.innerHTML = "";
      people.forEach(person => {
        const li = document.createElement("li");
        const amount = balances[person];
        li.textContent = `${person}: ${amount > 0 ? "+" : ""}${amount.toFixed(0)}원`;
        summaryList.appendChild(li);
      });
    }
  </script>
</body>
</html>
